<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<meta name="renderer" content="webkit">
    <meta http-equiv="x-ua-compatible" content="IE=Edge"> 
	<title>观看视频页</title>
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/iconfont.css">
	<link href="http://vjs.zencdn.net/5.8.8/video-js.css" rel="stylesheet">
	<link rel="stylesheet" href="css/video.css">
	<!-- If you'd like to support IE8 -->
	<script src="http://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js"></script>
	<style>
		.video-js{
			width:1200px;
			height:720px;
		}
		.video-js .vjs-big-play-button{
			left:50%;
			top:50%;
			transform:translate(-50%,-50%);
		}
	</style>
</head>
<body>
	<div class="fullscreen">
		<div class="videoBox">
			<span class="back" onclick="history.back()">返回</span>
			<video id="my-video" class="video-js" controls preload="auto" data-setup="{}" style="display: none">
				<source src="video/Honor.mp4" type='video/mp4'>
					<p class="vjs-no-js">
						To view this video please enable JavaScript, and consider upgrading to a web browser that
						<a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
					</p>
				</video>
			</div>
			<div class="custom">
				<div class="custom-header">
					<h3>苏州实验小学五年级</h3>
					<p>学科 : <span class="subject">数学</span>讲师 : <span class="teacher">金鑫</span></p>
				</div>
				<div class="custom-nav">
					<!-- <a href="#custom-body-comments" class="comments icon iconfont icon-iconfontedit active">讨论</a> -->
					<a href="#custom-body-notes" class="notes icon iconfont icon-bianji-copy ">笔记</a>
				</div>
				<div class="custom-body">
					<!-- <div id="custom-body-comments">
						<div class="send-mes">
							<textarea name="" id=""></textarea>
							<span id="send-mime-comment">发布讨论</span>
						</div>
						<div class="scroll-message">
						</div>
					</div> -->
					<div id="custom-body-notes">
						<div class="send-mes">
							<textarea name="" ></textarea>
							<span id="send-mime-notes">发布笔记</span>
						</div>
						<div class="scroll-message">
						</div>
					</div>
				</div>
				
			</div>
		</div>


		<script src="http://vjs.zencdn.net/5.8.8/video.js"></script>  
		<script src="http://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
		<script src="js/common.js"></script>
		<script>
			var myplayer = videojs('my-video')
			var CUSTOMWIDTH = 228;
			// var comments = new mycommonEvent.Tab($('.custom-nav a:eq(0)'))
			var notes = new mycommonEvent.Tab($('.custom-nav a:eq(0)'), renderNotes)
			$('.custom-nav a:eq(0)').trigger('click');
			var staticHeight = $('.custom-nav').height()+$('.custom-header').height()+$('.send-mes').height();
			var timer
			//发布绑定事件
			$('#send-mime-comment,#send-mime-notes').on('click',function(){
				var $textarea = $(this).siblings('textarea')
				console.log($textarea.val())
				if($textarea.val() === '') {
					return false
				}
				var data = {
					name:user.realname,
					img:user.img,
					content:$textarea.val(),
					date: mycommonEvent.formdate()
				}
				$textarea.val('');
				console.log(Math.round(myplayer.currentTime()))
				addToDialog ($(this),data)
			})

			//视频准备好的事件
			myplayer.ready(function(){
				var $myvideo = $('#my-video')
				$myvideo[0].style.display="block";
				$myvideo.find('video')[0].style.display='block';
				function changeVideoSize(){
					var w = $(window).width();
					var h = $(window).height();
					console.log('resize',w)
					$('.scroll-message').height(h -  staticHeight)
					var CUSTOMWIDTH = 228;
					$('.videoBox').width(w - CUSTOMWIDTH)
					if(w > 528) {
						var videoW = Math.round(w - CUSTOMWIDTH)
						var rate1 = (videoW / 1280).toFixed(2); 
						var rate2 = (h / 720).toFixed(2)
						var rate = rate1 > rate2 ? rate2 : rate1
						 $myvideo.width(1280*rate);
						 $myvideo.height(Math.round(720 * rate))
						 console.log(rate)
						 console.log($myvideo.width())
						 console.log($myvideo.height())
					}
				}
				//让视频文件自适应屏幕尺寸
				changeVideoSize();

				$(window).on('resize',changeVideoSize);
				//讨论功能和笔记功能
				
				// myplayer.on('play',function(){
				// 	timer = setInterval(function(){
				// 		console.log('play')
				// 		console.log(Math.floor(myplayer.currentTime()))
				// 		sortByTimeAndSendToDialog($('#send-mime-comment'),dataComments,Math.floor(myplayer.currentTime()))
				// 	},1000)
				// })
				// myplayer.on('pause', function() {
				// 	clearInterval(timer)
				// })
				//如果视频要求跳转到特定的播放时间
				function getCurrentTime(){
					var search = location.search.slice(1).split('=')
					var key = search[0]
					var value = decodeURIComponent(search[1])
					console.log(value)
					if(key === 'currentTime') {
						myplayer.currentTime(value)
						myplayer.play()
					}
				}
				getCurrentTime()
			})
			//增加到对话
			function addToDialog (dom,data) {
				var $column = $('<div  class ="commentsimilar">'+
							'<div class="avatar">'+
								'<img src="'+ data.img +'" alt="">'+
								'<span class="username">'+ data.name +'</span>'+
							'</div>'+
							'<div class="comments-content">'+
								'<p>'+ data.content +'</p>'+
								'<p class="operation">'+
									'<span class="sendtime">'+data.date+'</span>'+
								'</p>' +
							'</div> ' +
						'</div> ')
				// dataNotes.push(data)
				// localStorage.setItem('dataNotes',JSON.stringify(dataNotes))
				var $parent = dom.parent().siblings()
				$parent.prepend($column)	
				var columnHeight = $column.height()
				// console.log('height',columnHeight)
				// 这里的20是margin
				// $parent.scrollTop($parent.scrollTop() + columnHeight + 20)
			}

			//自动添加评论到页面
			// function sortByTimeAndSendToDialog(btn,data,currentTime) {
			// 	console.log(btn,data,currentTime)
			// 	for(var i = 0; i < data.length; i++){
			// 		if(data[i].videotime === currentTime) {
			// 			  data.splice(i,1)
			// 			  console.log(data.length)
			// 			  addToDialog($(btn),data[i])
			// 		}
			// 	}
			// }
			
			function renderNotes(){
				// console.log(dataNotes)
				for(var i = 0; i < dataNotes.length; i++ ) {
					addToDialog($('#send-mime-notes'), dataNotes[i])
				}
			}

		</script>
	</body>
	</html>